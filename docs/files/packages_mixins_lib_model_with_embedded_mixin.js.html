<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/mixins/lib/model_with_embedded_mixin.js - Extensions for Ember Data</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Extensions for Ember Data"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0-beta.4</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/DS.EmbeddedAdapter.html">DS.EmbeddedAdapter</a></li>
            
                <li><a href="../classes/DS.EmbeddedInModel.html">DS.EmbeddedInModel</a></li>
            
                <li><a href="../classes/DS.EmbeddedInModelMixin.html">DS.EmbeddedInModelMixin</a></li>
            
                <li><a href="../classes/DS.EmbeddedMixin.html">DS.EmbeddedMixin</a></li>
            
                <li><a href="../classes/DS.EmbeddedSerializer.html">DS.EmbeddedSerializer</a></li>
            
                <li><a href="../classes/DS.ModelWithEmbedded.html">DS.ModelWithEmbedded</a></li>
            
                <li><a href="../classes/DS.ModelWithEmbeddedMixin.html">DS.ModelWithEmbeddedMixin</a></li>
            
                <li><a href="../classes/DS.UnderscoredAdapterMixin.html">DS.UnderscoredAdapterMixin</a></li>
            
                <li><a href="../classes/DS.UnderscoredSerializer.html">DS.UnderscoredSerializer</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/embedded-adapter.html">embedded-adapter</a></li>
            
                <li><a href="../modules/ember-data.html">ember-data</a></li>
            
                <li><a href="../modules/mixins.html">mixins</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: packages/mixins/lib/model_with_embedded_mixin.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function(Ember, DS) {

var get = Ember.get;

/**
  @module ember-data
  @submodule mixins
**/

/**
  DS.ModelWithEmbeddedMixin

  @class ModelWithEmbeddedMixin
  @namespace DS
*/
DS.ModelWithEmbeddedMixin = Ember.Mixin.create({

  /**
    Observes state changes and notifies related objects to change state

    When record becomes dirty the embeddedNotifier
    notifies embedded records to transition to dirty state

    When record is saved the embeddedNotifier
    notifies embedded records to rollback to a saved state

    @method embeddedNotifier
  **/
  embeddedNotifier: (function(obj, path) {
    var serializer = this.store.serializerFor(this.constructor),
      config = serializer.get(&#x27;attrs&#x27;);

    if (!config) return;
    if (this.get(path) === &#x27;root.loaded.updated.uncommitted&#x27;) {
      enumerateRelationships.call(this, config, serializer, transitionRelatedToDirty);
    } else if (this.get(path) === &#x27;root.loaded.saved&#x27;) {
      enumerateRelationships.call(this, config, serializer, rollbackRelated);
    }
  }).observes(&#x27;currentState.stateName&#x27;)

});

// Check config for embedded flag
function isEmbedded(config) {
  return config &amp;&amp; (config.embedded === &#x27;always&#x27; || config.embedded === &#x27;load&#x27;);
}

// Enumerate over relationship objects, check serializer&#x27;s config
// execute a callback when relationship is embedded
function enumerateRelationships(config, serializer, callback) {
  var relationshipsByName = get(this.constructor, &#x27;relationshipsByName&#x27;);
  var relationships = relationshipsByName.values;
  for (var relation in relationships) {
    if (!relationships.hasOwnProperty(relation)) continue;
    var key = relationships[relation].key;
    if (!config || !isEmbedded(config[serializer.keyForAttribute(key)])) continue;
    callback(relationships[relation], this.get(key));
  }
}

// Rollback related record
function rollbackRelated(relationship, record) {
  if (!record || record.toString().indexOf(&#x27;Promise&#x27;) &gt; 0) return;
  var kind = relationship.kind;
  if (kind === &#x27;belongsTo&#x27;) {
    rollback(record);
  } else if (kind === &#x27;hasMany&#x27;) {
    record.content.forEach(rollback);
  }
}

// Call the model&#x27;s rollback method
function rollback(model) {
  model.rollback();
}

// Transition related record(s) to dirty state
function transitionRelatedToDirty(relationship, record) {
  if (!record || record.toString().indexOf(&#x27;Promise&#x27;) &gt; 0) return;
  var kind = relationship.kind;
  if (kind === &#x27;belongsTo&#x27;) {
    transitionToDirty(record);
  } else if (kind === &#x27;hasMany&#x27;) {
    record.content.forEach(transitionToDirty);
  }
}

// Transition record to dirty state
function transitionToDirty(record) {
  record.transitionTo(&#x27;updated.uncommitted&#x27;);
}

}(Ember, DS));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
